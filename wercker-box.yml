name: golang
version: 0.0.11
inherits: wercker/ubuntu12.04-webessentials@0.0.3
type : main
platform : ubuntu@12.04
description : golang
keywords:
  - golang
  - go
packages :
  - golang
script : |
  sudo apt-get update
  sudo chef-solo -c $WERCKER_SOURCE_DIR/solo.rb -j $WERCKER_SOURCE_DIR/solo.json -l debug

box-detect:
  priority : 900
  version : 
  detect:
    - files:
      - .godir
      
default-build:
  python:
    priority : 50
    detect:
      - default: true
    text-to-append: |
      # Build definition
      build:
        # The steps that will be executed on build
        steps:
          - script:
              name: setup golang
              code: |
                mkdir $HOME/mygo
                export GOPATH=$HOME/mygo
                export PATH=$PATH:$GOPATH/bin
                mkdir $GOPATH/bin
                mkdir $GOPATH/pkg
                if test "${GIT_SSH_PROJECT+set}" == set; then mkdir -p $GOPATH/src/$GIT_SSH_DOMAIN/$GIT_SSH_OWNER/$GIT_SSH_PROJECT; else ln -s /build $GOPATH/src; fi
                if test "${GIT_SSH_PROJECT+set}" == set; then cp -R /build/* $GOPATH/src/$GIT_SSH_DOMAIN/$GIT_SSH_OWNER/$GIT_SSH_PROJECT;  fi
                if test "${GIT_SSH_PROJECT+set}" == set; then export WERCKER_ROOT=$GOPATH/src/$GIT_SSH_DOMAIN/$GIT_SSH_OWNER/$GIT_SSH_PROJECT; fi
          - script:
              name: go get
              code: |
                cd $WERCKER_SOURCE_DIR
                go version
                go get ./...
          - script: 
              name: go build
              code: |
                go build .
          - script:
              name: go test
              code: |
                go test ./...
